{
    "app-id": "gov.cti.InVesalius",
    "runtime": "org.freedesktop.Platform",
    "runtime-version": "1.6",
    "sdk": "org.freedesktop.Sdk",
    "sdk-extensions": ["org.freedesktop.Sdk.Extension.gfortran-62"],
    "command": "runner.sh",
    "modules": [{
        "name": "vtk",
        "sources": [
            {
                "type": "archive",
                "url": "https://www.vtk.org/files/release/7.1/VTK-7.1.1.tar.gz",
                "sha256": "2d5cdd048540144d821715c718932591418bb48f5b6bb19becdae62339efa75a"
            }
        ],
        "buildsystem": "cmake",
        "config-opts": [
            "-DBUILD_DOCUMENTATION=OFF",
            "-DBUILD_EXAMPLES=OFF",
            "-DBUILD_SHARED_LIBS=ON",
            "-DVTK_USE_TK=OFF",
            "-DVTK_WRAP_JAVA=OFF",
            "-DVTK_WRAP_PYTHON=ON",
            "-DVTK_WRAP_TCL=OFF",
            "-DCMAKE_BUILD_TYPE=Release",
            "-DPYTHON_EXECUTABLE=/usr/bin/python3"
        ]
    },
    {
        "name": "swig",
        "sources":[{
            "type": "archive",
            "url": "http://prdownloads.sourceforge.net/swig/swig-3.0.12.tar.gz",
            "sha256": "7cf9f447ae7ed1c51722efc45e7f14418d15d7a1e143ac9f09a668999f4fc94d"
        }],
        "config-opts": [
            "--without-pcre",
            "--disable-ccache",
            "--without-tcl",
            "--without-tcl",
            "--without-perl5",
            "--without-octave",
            "--without-scilab",
            "--without-java",
            "--without-ruby"
        ]
    },
    {
        "name": "gdcm",
        "builddir": true,
        "sources": [{
            "type": "archive",
            "url": "https://netix.dl.sourceforge.net/project/gdcm/gdcm%202.x/GDCM%202.8.8/gdcm-2.8.8.tar.gz",
            "sha256": "073405d0f3532b8b5d813b6d3d48318b297d6141d2a2d18280f1b86051ac745e"
        }],
        "buildsystem": "cmake",
        "config-opts": [
            "-DGDCM_BUILD_APPLICATIONS=OFF",
            "-DGDCM_BUILD_SHARED_LIBS=ON",
            "-DCMAKE_BUILD_TYPE=Release",
            "-DGDCM_WRAP_PYTHON=ON",
            "-DPYTHON_EXECUTABLE=/usr/bin/python3",
            "-DGDCM_INSTALL_PYTHONMODULE_DIR=/app/lib/python3.5/site-packages/",
            "-DGDCM_USE_VTK=ON",
            "-DGDCM_BUILD_DOCBOOK_MANPAGES:BOOL=OFF"
        ]
    },

    {
        "name": "gfortran",
        "buildsystem": "simple",
        "build-commands": [ "/usr/lib/sdk/gfortran-62/install.sh" ]
    },
    {
        "name": "lapack",
        "buildsystem": "cmake",
        "builddir": true,
        "config-opts": [
            "-DCMAKE_BUILD_TYPE=Release",
            "-DBUILD_SHARED_LIBS=ON",
            "-DBUILD_TESTING=OFF",
            "-DCMAKE_Fortran_COMPILER=/usr/lib/sdk/gfortran-62/bin/gfortran",
            "-DLAPACKE=ON",
            "-DCBLAS=ON"
        ],
        "sources": [
            {
                "type": "archive",
                "url": "http://www.netlib.org/lapack/lapack-3.8.0.tar.gz",
                "sha512": "17786cb7306fccdc9b4a242de7f64fc261ebe6a10b6ec55f519deb4cb673cb137e8742aa5698fd2dc52f1cd56d3bd116af3f593a01dcf6770c4dcc86c50b2a7f"
            }
        ],
        "cleanup": [ "/lib/cmake" ]
    },

    "python3-numpy.json",
    "python3-scipy.json",
    "python3-cython.json",
    "python3-Pillow.json",
    "python3-setuptools.json",
    "python3-setuptools_scm.json",
    "python3-python-dateutil.json",
    "python3-matplotlib.json",
    "python3-scikit-image.json",
    "python3-bz2file.json",
    "python3-nibabel.json",
    "python3-pyserial.json",
    "python3-psutil.json",
    "python3-configparser.json",
    "shared-modules/glu/glu-9.0.0.json",
    {
        "name": "wxWidgets",
        "rm-configure": true,
        "config-opts": [
            "--with-gtk=3",
            "--disable-sdltest",
            "--disable-webkit",
            "--disable-webview",
            "--disable-webviewwebkit",
            "--with-opengl"
        ],
        "cxxflags": [
            "-std=c++11"
        ],
        "sources": [
            {
                "type": "archive",
                "url": "https://github.com/wxWidgets/wxWidgets/releases/download/v3.1.2/wxWidgets-3.1.2.tar.bz2",
                "sha256": "4cb8d23d70f9261debf7d6cfeca667fc0a7d2b6565adb8f1c484f9b674f1f27a"
            },
            {
                "type": "script",
                "path": "autogen.sh",
                "commands": [
                    "cp -p /usr/share/automake-*/config.{sub,guess} .",
                    "autoconf -f -B build/autoconf_prepend-include"
                ]
            }
        ]
    },
    {
        "name" : "sip",
        "sources" : [
            {
                "type" : "archive",
                "url" : "https://sourceforge.net/projects/pyqt/files/sip/sip-4.19.12/sip-4.19.12.tar.gz",
                "sha256" : "24617fc31b983df075500ecac0e99d2fb48bf63ba82d4a17518659e571923822"
            },
            {
                "type": "script",
                "commands": [
                    "python3 configure.py -b ${FLATPAK_DEST}/bin -d ${FLATPAK_DEST}/lib/python3.5/site-packages -e ${FLATPAK_DEST}/include -v ${FLATPAK_DEST}/share/sip --stubsdir=${FLATPAK_DEST}/lib/python3.5/site-packages"
                ],
                "dest-filename": "configure"
            }
        ],
        "cleanup" : [
            "/bin",
            "/include"
        ]
    },
    {
        "name": "wxpython",
        "buildsystem": "simple",
        "build-commands": [
            "cd ext/wxWidgets && cp -p /usr/share/automake-*/config.{sub,guess} . &&  autoconf -f -B build/autoconf_prepend-include && ./configure --disable-sdltest --disable-webkit --disable-webview --disable-webviewwebkit --disable-ribbon --disable-propgrid --disable-xru --disable-richtext --with-gtk=3 && make",
            "python3 build.py sip --nodoc build_py --build_dir=ext/wxWidgets",
            "python3 build.py install_py"
        ],

        "build-options": {
            "env": {
                "WAF": "${PWD}/waf-2.0.14",
                "SIP": "${FLATPAK_DEST}/bin/sip"
            }
        },
        "sources": [
            {
                "type": "archive",
                "url": "https://files.pythonhosted.org/packages/17/74/7c3ced03c3c76b9f98e4a0edae1801755a7599ebf481c04d9f77dfff17e3/wxPython-4.0.4.tar.gz",
                "sha256": "0d9ef4260cb2f3e23ed9dcf6baa905ba585ac7d631613cddc299c4c83463ae29"
            },
            {
                "type": "file",
                "url": "https://waf.io/waf-2.0.14",
                "sha256": "c5bc6083bba5e24415bb83872fa9e048afa150109a7e8855af679076d0779b22"
            }
        ]
    },
    {
        "name": "runner",
        "buildsystem": "simple",
        "build-commands": [
            "install -D runner.sh /app/bin/runner.sh",
            "install -D hello.py /app/bin/hello.py"
        ],
        "sources": [
            {
                "type": "file",
                "path": "hello.py"
            },
            {
                "type": "file",
                "path": "runner.sh"
            }
        ]
    }
    ]
}
